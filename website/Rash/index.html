<!DOCTYPE html>
<html lang="en" style="background-color: #000000;">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
        <meta name="color-scheme" content="dark">
        <title>Rashboard</title>
        <script src="https://cdn.tailwindcss.com"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
        <link rel="icon" type="image/png" href="images/favicon-96x96.png" sizes="96x96" />
        <link rel="icon" type="image/svg+xml" href="images/favicon.svg" />
        <link rel="shortcut icon" href="images/favicon.ico" />
        <link rel="apple-touch-icon" sizes="180x180" href="images/apple-touch-icon.png" />
        <meta name="apple-mobile-web-app-title" content="Rash" />
        <link rel="manifest" href="images/site.webmanifest" />

        <style>
            .safe-header {
                padding-top: max(env(safe-area-inset-top));
            }

            .safe-bottom {
                padding-bottom: env(safe-area-inset-bottom);
            }
        </style>


        <style>
            @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap');

            /* CRITICAL FIX: Force black everywhere to prevent white flashes */
            html {
                background-color: #000000 !important;
                height: 100%;
                overscroll-behavior: none; /* Prevents "bounce" revealing white background */
            }

            body {
                font-family: 'Inter', sans-serif;
                background-color: #000000 !important;
                color: #e4e4e7; /* zinc-200 */
                -webkit-tap-highlight-color: transparent;
                user-select: none;
                min-height: 100vh;
                width: 100%;
                margin: 0;
                overflow-x: hidden;
            }

            /* Hide scrollbar for sleek look */
            ::-webkit-scrollbar {
                width: 6px;
            }
            ::-webkit-scrollbar-track {
                background: #000;
            }
            ::-webkit-scrollbar-thumb {
                background: #333;
                border-radius: 3px;
            }

            .glass-panel {
                background: rgba(0, 0, 0, 0.8); /* Darker glass */
                backdrop-filter: blur(12px);
                border: 1px solid rgba(255, 255, 255, 0.08);
            }

            .card-hover:active {
                transform: scale(0.98);
            }

            /* Dragging Visuals */
            .sortable-ghost {
                opacity: 0.2;
                background: #333 !important;
            }
            .sortable-drag {
                cursor: grabbing;
                opacity: 1;
                transform: scale(1.05);
                background: #111 !important;
                box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.5), 0 10px 10px -5px rgba(0, 0, 0, 0.5);
                z-index: 100;
            }

            /* Context Menu Animation */
            .context-menu {
                transition: opacity 0.15s ease, transform 0.15s ease;
                opacity: 0;
                pointer-events: none;
                transform: scale(0.95);
            }
            .context-menu.active {
                opacity: 1;
                pointer-events: auto;
                transform: scale(1);
            }

            /* Modal Animation */
            dialog {
                background: transparent;
                border: none;
                padding: 0;
                margin: auto;
                max-width: 100%;
                max-height: 100%;
            }
            dialog::backdrop {
                background: rgba(0, 0, 0, 0.9);
                backdrop-filter: blur(4px);
            }
            .modal-content {
                transform: translateY(20px);
                opacity: 0;
                transition: all 0.3s ease;
            }
            dialog[open] .modal-content {
                transform: translateY(0);
                opacity: 1;
            }

            /* Input styling */
            .custom-input {
                background: #000;
                border: 1px solid #27272a;
                color: white;
                transition: border-color 0.2s;
            }
            .custom-input:focus {
                outline: none;
                border-color: #52525b;
            }

            /* Toast Notification */
            .toast {
                position: fixed;
                bottom: 30px;
                left: 50%;
                transform: translateX(-50%) translateY(100px);
                background: #fff;
                color: #000;
                padding: 12px 24px;
                border-radius: 50px;
                font-weight: 600;
                font-size: 0.875rem;
                box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.5);
                transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
                opacity: 0;
                z-index: 100;
                display: flex;
                align-items: center;
                gap: 8px;
                pointer-events: none;
            }
            .toast.show {
                transform: translateX(-50%) translateY(0);
                opacity: 1;
            }
        </style>
    </head>
    
    <body class="min-h-screen flex flex-col p-6" style="background-color: #000000;">

        <header class="mb-8 flex justify-between items-center">
            <div class="safe-header">
                <h1 class="text-2xl font-bold tracking-tight text-white">Rashboard</h1>
                <p class="text-xs text-zinc-500 mt-1">Everything in one place</p>
            </div>
            <button onclick="manualSave()" class="w-10 h-10 rounded-full bg-white text-black flex items-center justify-center hover:bg-zinc-200 transition-colors">
                <i class="fa-solid fa-check"></i>
            </button>
        </header>

        <main id="grid-container" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4">
            </main>

        <div class="card-hover cursor-pointer border border-zinc-800 border-dashed rounded-[2rem] h-40 flex flex-col items-center justify-center text-zinc-500 hover:text-zinc-300 hover:border-zinc-600 transition-all mt-4" onclick="openAddModal()">
            <i class="fa-solid fa-plus text-2xl mb-2"></i>
            <span class="text-sm">Add New</span>
        </div>

        <div id="context-menu" class="context-menu fixed z-50 min-w-[160px] glass-panel rounded-xl overflow-hidden shadow-2xl flex flex-col py-1 bg-[#0a0a0a]">
            </div>

        <dialog id="item-modal">
            <div class="modal-content glass-panel p-6 rounded-3xl w-[90vw] max-w-md shadow-2xl bg-[#0a0a0a] border border-zinc-900">
                <h2 id="modal-title" class="text-xl font-bold text-white mb-6">Add Shortcut</h2>
                
                <div class="space-y-4">
                    <div>
                        <label class="block text-xs text-zinc-500 uppercase font-bold mb-2">Name</label>
                        <input type="text" id="input-name" class="custom-input w-full p-4 rounded-xl" placeholder="e.g. Google">
                    </div>
                    <div>
                        <label class="block text-xs text-zinc-500 uppercase font-bold mb-2">URL</label>
                        <input type="url" id="input-url" class="custom-input w-full p-4 rounded-xl" placeholder="https://...">
                    </div>
                </div>

                <div class="flex gap-3 mt-8">
                    <button onclick="closeModal('item-modal')" class="flex-1 py-3 rounded-xl bg-zinc-900 text-zinc-400 hover:bg-zinc-800 transition">Cancel</button>
                    <button onclick="saveItem()" class="flex-1 py-3 rounded-xl bg-white text-black font-semibold hover:bg-zinc-200 transition">Save</button>
                </div>
            </div>
        </dialog>

        <dialog id="appearance-modal">
            <div class="modal-content glass-panel p-6 rounded-3xl w-[90vw] max-w-md shadow-2xl bg-[#0a0a0a] border border-zinc-900">
                <h2 class="text-xl font-bold text-white mb-6">Customize Icon</h2>
                
                <label class="block text-xs text-zinc-500 uppercase font-bold mb-3">Choose Color</label>
                <div class="grid grid-cols-5 gap-3 mb-6">
                    <button onclick="setIconColor('bg-zinc-900')" class="w-10 h-10 rounded-full bg-zinc-900 border border-zinc-700"></button>
                    <button onclick="setIconColor('bg-red-900')" class="w-10 h-10 rounded-full bg-red-900"></button>
                    <button onclick="setIconColor('bg-orange-900')" class="w-10 h-10 rounded-full bg-orange-900"></button>
                    <button onclick="setIconColor('bg-emerald-900')" class="w-10 h-10 rounded-full bg-emerald-900"></button>
                    <button onclick="setIconColor('bg-blue-900')" class="w-10 h-10 rounded-full bg-blue-900"></button>
                    <button onclick="setIconColor('bg-indigo-900')" class="w-10 h-10 rounded-full bg-indigo-900"></button>
                    <button onclick="setIconColor('bg-purple-900')" class="w-10 h-10 rounded-full bg-purple-900"></button>
                    <button onclick="setIconColor('bg-pink-900')" class="w-10 h-10 rounded-full bg-pink-900"></button>
                </div>

                <div class="mb-2 text-center text-zinc-500 text-sm">- OR -</div>
                <div>
                    <label class="block text-xs text-zinc-500 uppercase font-bold mb-2">Image URL</label>
                    <input type="url" id="input-image" class="custom-input w-full p-4 rounded-xl" placeholder="https://example.com/images/logo.png">
                </div>

                <div class="flex gap-3 mt-8">
                    <button onclick="closeModal('appearance-modal')" class="flex-1 py-3 rounded-xl bg-zinc-900 text-zinc-400 hover:bg-zinc-800 transition">Cancel</button>
                    <button onclick="saveAppearance()" class="flex-1 py-3 rounded-xl bg-white text-black font-semibold hover:bg-zinc-200 transition">Save</button>
                </div>
            </div>
        </dialog>

        <div id="toast" class="toast">
            <i class="fa-solid fa-circle-check text-emerald-600"></i>
            <span>Saved successfully</span>
        </div>

        <script>
            // --- State Management ---
            let items = JSON.parse(localStorage.getItem('dashboardItems')) || [
                { id: 1, name: 'Amazon', url: 'https://www.amazon.com', color: 'bg-zinc-900', img: 'https://play-lh.googleusercontent.com/urVIq3KHpF9hAm7FJpE2I4YlGfqMFpUdb5GMtQcASC1ODbWe1zuQFrF99ZPTELfE8wA=w240-h480-rw' },
                { id: 2, name: 'Pinterest', url: 'https://www.pinterest.com/', color: 'bg-red-900', img: 'https://play-lh.googleusercontent.com/6CFQQ0b9r5fzF1v6f0gIirWsOGL7sGWkJifuUQxxhbCMcBx5aSG_cNXpjDKDn5c1jwjq=w240-h480-rw' },
                { id: 3, name: 'GitHub', url: 'https://github.com', color: 'bg-zinc-900', img: 'https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png' }
            ];

            let currentEditId = null;
            let contextTargetId = null;
            
            const grid = document.getElementById('grid-container');
            const contextMenu = document.getElementById('context-menu');

            // --- Core Rendering ---
            function render() {
                grid.innerHTML = '';
                items.forEach(item => {
                    const div = document.createElement('div');
                    
                    // Added data-id for sorting
                    div.setAttribute('data-id', item.id);
                    
                    div.className = 'card-hover relative group bg-[#0a0a0a] rounded-[2rem] p-4 flex flex-col items-center justify-center gap-3 h-40 border border-zinc-900 hover:border-zinc-700 transition-all cursor-pointer select-none';
                    
                    // Content
                    let iconContent = '';
                    if (item.img) {
                        iconContent = `<img src="${item.img}" class="w-full h-full object-cover rounded-full" onerror="this.style.display='none'">`;
                    } else {
                        // Get initials
                        const initial = item.name ? item.name.charAt(0).toUpperCase() : '?';
                        iconContent = `<span class="text-xl font-bold text-white">${initial}</span>`;
                    }

                    div.innerHTML = `
                        <div class="icon-placeholder w-16 h-16 rounded-full ${item.color || 'bg-zinc-900'} flex items-center justify-center overflow-hidden shadow-lg transition-transform group-hover:scale-105" data-id="${item.id}">
                            ${iconContent}
                        </div>
                        <span class="font-medium text-sm text-zinc-300 truncate max-w-full px-2">${item.name}</span>
                    `;

                    // Logic: Click to Open URL
                    div.onclick = (e) => {
                        // Prevent opening if we just finished a long press or context menu action or drag
                        if (contextMenu.classList.contains('active') || div.classList.contains('sortable-drag')) {
                            closeContextMenu();
                            return;
                        }
                        window.open(item.url.startsWith('http') ? item.url : `https://${item.url}`, '_blank');
                    };

                    // Logic: Attach Context Menu/Long Press events
                    attachLongPress(div, item.id, 'card');
                    
                    // Specific listener for the icon circle to override card context
                    const iconDiv = div.querySelector('.icon-placeholder');
                    attachLongPress(iconDiv, item.id, 'icon');

                    grid.appendChild(div);
                });
            }

            // --- Drag and Drop Logic (SortableJS) ---
            new Sortable(grid, {
                animation: 150,
                ghostClass: 'sortable-ghost',
                dragClass: 'sortable-drag',
                delay: 200, // 200ms delay on touch to prevent accidental drags
                delayOnTouchOnly: true, // Immediate drag on desktop
                onEnd: function (evt) {
                    // When drag ends, update the order in the 'items' array
                    const newOrderIds = Array.from(grid.children).map(child => child.getAttribute('data-id'));
                    
                    // Create a new array based on the visual order
                    const reorderedItems = newOrderIds.map(id => {
                        return items.find(item => item.id == id);
                    }).filter(item => item !== undefined); // Safety check

                    items = reorderedItems;
                    localStorage.setItem('dashboardItems', JSON.stringify(items));
                }
            });

            // --- Interactions (Context Menu & Long Press) ---
            let longPressTimer;
            let isLongPress = false;

            function attachLongPress(element, id, type) {
                // Desktop Right Click
                element.addEventListener('contextmenu', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    showContextMenu(e.clientX, e.clientY, id, type);
                });

                // Mobile Long Press
                element.addEventListener('touchstart', (e) => {
                    isLongPress = false;
                    longPressTimer = setTimeout(() => {
                        isLongPress = true;
                        // Vibrate for feedback
                        if (navigator.vibrate) navigator.vibrate(50);
                        const touch = e.touches[0];
                        showContextMenu(touch.clientX, touch.clientY, id, type);
                    }, 600); // 600ms for Context Menu (Longer than Drag delay)
                }, { passive: false });

                // Cancel if moved or lifted
                element.addEventListener('touchmove', () => {
                    clearTimeout(longPressTimer);
                });

                element.addEventListener('touchend', (e) => {
                    clearTimeout(longPressTimer);
                    if (isLongPress) {
                        e.preventDefault(); // Prevent click after long press
                        e.stopPropagation();
                    }
                });
            }

            function showContextMenu(x, y, id, type) {
                contextTargetId = id;
                contextMenu.innerHTML = ''; // Clear previous options

                // Build Options based on what was clicked
                if (type === 'card') {
                    contextMenu.innerHTML = `
                        <div onclick="openEditModal(${id})" class="px-4 py-3 hover:bg-white/10 text-sm cursor-pointer flex items-center gap-3">
                            <i class="fa-solid fa-pen text-zinc-400"></i> Edit Details
                        </div>
                        <div onclick="deleteItem(${id})" class="px-4 py-3 hover:bg-white/10 text-sm cursor-pointer flex items-center gap-3 text-red-400">
                            <i class="fa-solid fa-trash"></i> Delete
                        </div>
                    `;
                } else if (type === 'icon') {
                    contextMenu.innerHTML = `
                        <div onclick="openAppearanceModal(${id})" class="px-4 py-3 hover:bg-white/10 text-sm cursor-pointer flex items-center gap-3">
                            <i class="fa-solid fa-palette text-zinc-400"></i> Change Icon
                        </div>
                    `;
                }

                // Positioning logic to keep in bounds
                const menuWidth = 160;
                const menuHeight = type === 'card' ? 90 : 50;
                
                let posX = x;
                let posY = y;

                if ((x + menuWidth) > window.innerWidth) posX = window.innerWidth - menuWidth - 10;
                if ((y + menuHeight) > window.innerHeight) posY = window.innerHeight - menuHeight - 10;

                contextMenu.style.left = posX + 'px';
                contextMenu.style.top = posY + 'px';
                contextMenu.classList.add('active');
            }

            function closeContextMenu() {
                contextMenu.classList.remove('active');
                contextTargetId = null;
            }

            window.addEventListener('click', closeContextMenu);
            window.addEventListener('scroll', closeContextMenu);

            // --- Modals ---
            const itemModal = document.getElementById('item-modal');
            const appearanceModal = document.getElementById('appearance-modal');

            function openAddModal() {
                currentEditId = null;
                document.getElementById('modal-title').innerText = 'Add Shortcut';
                document.getElementById('input-name').value = '';
                document.getElementById('input-url').value = '';
                itemModal.showModal();
            }

            function openEditModal(id) {
                currentEditId = id;
                const item = items.find(i => i.id === id);
                if (!item) return;

                document.getElementById('modal-title').innerText = 'Edit Shortcut';
                document.getElementById('input-name').value = item.name || '';
                document.getElementById('input-url').value = item.url || '';
                itemModal.showModal();
            }

            function closeModal(modalId) {
                document.getElementById(modalId).close();
            }

            function saveItem() {
                const name = document.getElementById('input-name').value.trim();
                const url = document.getElementById('input-url').value.trim();

                if (!name || !url) return;

                if (currentEditId) {
                    const item = items.find(i => i.id === currentEditId);
                    if (item) {
                        item.name = name;
                        item.url = url;
                    }
                } else {
                    const newId = Date.now();
                    items.push({ id: newId, name, url, color: 'bg-zinc-900', img: null });
                }

                localStorage.setItem('dashboardItems', JSON.stringify(items));
                render();
                closeModal('item-modal');
            }

            function deleteItem(id) {
                items = items.filter(i => i.id !== id);
                localStorage.setItem('dashboardItems', JSON.stringify(items));
                render();
                closeContextMenu();
            }

            function openAppearanceModal(id) {
                currentEditId = id;
                const item = items.find(i => i.id === id);
                if (!item) return;

                document.getElementById('input-image').value = item.img || '';
                appearanceModal.showModal();
                closeContextMenu();
            }

            function saveAppearance() {
                const item = items.find(i => i.id === currentEditId);
                if (!item) return;

                const imgUrl = document.getElementById('input-image').value.trim();
                if (imgUrl) {
                    item.img = imgUrl;
                    item.color = 'bg-zinc-900'; // fallback color
                }
                localStorage.setItem('dashboardItems', JSON.stringify(items));
                render();
                closeModal('appearance-modal');
            }

            function setIconColor(color) {
                const item = items.find(i => i.id === currentEditId);
                if (!item) return;
                item.color = color;
                item.img = null; // clear image if color is set
            }

            function manualSave() {
                localStorage.setItem('dashboardItems', JSON.stringify(items));
                showToast('Saved successfully');
            }

            function showToast(msg) {
                const toast = document.getElementById('toast');
                toast.querySelector('span').innerText = msg;
                toast.classList.add('show');
                setTimeout(() => {
                    toast.classList.remove('show');
                }, 2000);
            }

            // --- Initialize ---
            render();
        </script>
    </body>
    </html>